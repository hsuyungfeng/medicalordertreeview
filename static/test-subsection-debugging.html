<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subsection ä»£ç¢¼ç¯„åœè¨ºæ–·å·¥å…·</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    .header h1 { font-size: 28px; margin-bottom: 10px; }
    .section { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .section h2 { color: #667eea; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
    .test-group { margin-bottom: 20px; }
    .test-item {
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 4px;
    }
    .test-label { font-weight: bold; color: #667eea; margin-bottom: 8px; }
    .test-input, .test-button {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
      font-size: 14px;
    }
    .test-button {
      background: #667eea;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    .test-button:hover { background: #5568d3; }
    .test-button.danger { background: #e74c3c; }
    .test-button.danger:hover { background: #c0392b; }
    .output {
      background: #f0f4f8;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      margin-top: 10px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    .output-success { color: #27ae60; font-weight: bold; }
    .output-error { color: #e74c3c; font-weight: bold; }
    .output-warning { color: #f39c12; font-weight: bold; }
    .output-info { color: #3498db; }
    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      margin: 5px 5px 5px 0;
    }
    .status-ok { background: #d4edda; color: #155724; }
    .status-error { background: #f8d7da; color: #721c24; }
    .status-warning { background: #fff3cd; color: #856404; }
    .code-example {
      background: #f0f4f8;
      border-left: 4px solid #667eea;
      padding: 12px;
      margin: 10px 0;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ”§ Subsection ä»£ç¢¼ç¯„åœç¯©é¸è¨ºæ–·å·¥å…·</h1>
      <p>ç”¨æ–¼è¨ºæ–·å’Œæ¸¬è©¦ subsection ç¯€é»çš„ä»£ç¢¼ç¯„åœæå–å’Œè¡¨æ ¼ç¯©é¸åŠŸèƒ½</p>
    </div>

    <div class="grid-2">
      <!-- å·¦å´ï¼šæ¸¬è©¦å·¥å…· -->
      <div>
        <div class="section">
          <h2>ğŸ“ æ¸¬è©¦ä»£ç¢¼ç¯„åœæå–</h2>

          <div class="test-group">
            <div class="test-item">
              <div class="test-label">è¼¸å…¥æ¨™ç±¤æ–‡å­—ï¼š</div>
              <input type="text" class="test-input" id="labelInput"
                value="äºŒã€å‰µå‚·è™•ç½®Wound Treatmen"
                placeholder="ä¾‹: äºŒã€å‰µå‚·è™•ç½® (48001-48035)">
              <button class="test-button" onclick="testExtractFromLabel()">æ¸¬è©¦æå–ï¼ˆæ¨™ç±¤ï¼‰</button>
            </div>
          </div>

          <div class="test-group">
            <div class="test-item">
              <div class="test-label">è¼¸å…¥å…§å®¹æ–‡å­—ï¼š</div>
              <input type="text" class="test-input" id="contentInput"
                value="äºŒã€å‰µå‚·è™•ç½®Wound Treatment (48001-48035)"
                placeholder="ä¾‹: äºŒã€å‰µå‚·è™•ç½®Wound Treatment (48001-48035)">
              <button class="test-button" onclick="testExtractFromContent()">æ¸¬è©¦æå–ï¼ˆå…§å®¹ï¼‰</button>
            </div>
          </div>

          <div class="test-group">
            <div class="test-item">
              <div class="test-label">æå–çµæœï¼š</div>
              <div class="output" id="extractOutput">ç­‰å¾…æ¸¬è©¦...</div>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>ğŸ“Š æ¸¬è©¦è¡¨æ ¼ç¯©é¸</h2>

          <div class="test-group">
            <div class="test-item">
              <div class="test-label">ä»£ç¢¼ç¯„åœï¼š</div>
              <input type="text" class="test-input" id="startCodeInput" value="48001" placeholder="èµ·å§‹ä»£ç¢¼">
              <input type="text" class="test-input" id="endCodeInput" value="48035" placeholder="çµæŸä»£ç¢¼">
              <button class="test-button" onclick="testFilterByCodeRange()">æ¸¬è©¦ç¯©é¸</button>
            </div>
          </div>

          <div class="test-group">
            <div class="test-item">
              <div class="test-label">ç¯©é¸çµæœï¼š</div>
              <div class="output" id="filterOutput">ç­‰å¾…æ¸¬è©¦...</div>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>ğŸ› ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h2>
          <div class="test-group">
            <div class="test-item">
              <button class="test-button" onclick="checkSystemStatus()">æª¢æŸ¥ç³»çµ±ç‹€æ…‹</button>
              <button class="test-button danger" onclick="resetDebugConsole()">æ¸…ç©ºæ—¥èªŒ</button>
            </div>
          </div>
          <div class="output" id="statusOutput">ç­‰å¾…æª¢æŸ¥...</div>
        </div>
      </div>

      <!-- å³å´ï¼šå¯¦æ™‚æ—¥èªŒå’Œèªªæ˜ -->
      <div>
        <div class="section">
          <h2>ğŸ“‹ å¯¦æ™‚ Console æ—¥èªŒ</h2>
          <div class="output" id="consoleOutput" style="max-height: 400px;">
            <div class="output-info">åˆå§‹åŒ–å®Œæˆï¼Œé–‹å§‹è¨ºæ–·...</div>
          </div>
        </div>

        <div class="section">
          <h2>ğŸ“– æ¸¬è©¦èªªæ˜</h2>
          <p><strong>æ­¥é©Ÿ 1ï¼šæ¸¬è©¦ä»£ç¢¼ç¯„åœæå–</strong></p>
          <p>æª¢æŸ¥ extractCodeRangeFromLabel() æ˜¯å¦èƒ½å¾æ¨™ç±¤æˆ–å…§å®¹ä¸­æå–ä»£ç¢¼ç¯„åœã€‚æ‡‰è©²èƒ½å¾å…§å®¹ä¸­æå– 48001-48035ã€‚</p>

          <p style="margin-top: 15px;"><strong>æ­¥é©Ÿ 2ï¼šæ¸¬è©¦è¡¨æ ¼ç¯©é¸</strong></p>
          <p>æª¢æŸ¥ filterByCodeRange() æ˜¯å¦èƒ½æ­£ç¢ºç¯©é¸ CSV æ•¸æ“šã€‚æ‡‰è©²ç¯©é¸å‡º 26 ç­†è¨˜éŒ„ï¼ˆä»£ç¢¼ 48001C åˆ° 48035Cï¼‰ã€‚</p>

          <p style="margin-top: 15px;"><strong>æ­¥é©Ÿ 3ï¼šæª¢æŸ¥ç³»çµ±ç‹€æ…‹</strong></p>
          <p>é©—è­‰ csvTableRendererã€æ¨¹å½¢åŠ è¼‰å™¨ã€CSV æ•¸æ“šç­‰æ˜¯å¦æ­£ç¢ºåˆå§‹åŒ–ã€‚</p>

          <p style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;"><strong>âœ… é æœŸçµæœï¼š</strong></p>
          <ul style="margin-left: 20px; margin-top: 10px;">
            <li>æ­¥é©Ÿ 1ï¼šæå–å‡º {start: '48001', end: '48035'}</li>
            <li>æ­¥é©Ÿ 2ï¼šç¯©é¸å‡º 26 ç­†è¨˜éŒ„</li>
            <li>æ­¥é©Ÿ 3ï¼šæ‰€æœ‰çµ„ä»¶éƒ½å·²åˆå§‹åŒ–</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- å¼•å…¥ä¾è³´è…³æœ¬ -->
  <script src="js/table-renderer.js"></script>
  <script src="js/csv-table-renderer.js"></script>
  <script src="js/tree-loader.js"></script>

  <script>
    // æ—¥èªŒæ”¶é›†å™¨
    const debugLogs = [];
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;

    console.log = function(...args) {
      originalLog.apply(console, args);
      addDebugLog(args.join(' '));
    };

    console.error = function(...args) {
      originalError.apply(console, args);
      addDebugLog('âŒ ' + args.join(' '));
    };

    console.warn = function(...args) {
      originalWarn.apply(console, args);
      addDebugLog('âš ï¸ ' + args.join(' '));
    };

    function addDebugLog(message) {
      debugLogs.push(message);
      updateConsoleOutput();
    }

    function updateConsoleOutput() {
      const output = document.getElementById('consoleOutput');
      const lastLogs = debugLogs.slice(-20);
      output.innerHTML = lastLogs.map(log => {
        if (log.includes('âŒ')) return `<div class="output-error">${log}</div>`;
        if (log.includes('âš ï¸')) return `<div class="output-warning">${log}</div>`;
        if (log.includes('âœ…')) return `<div class="output-success">${log}</div>`;
        return `<div class="output-info">${log}</div>`;
      }).join('');
      output.scrollTop = output.scrollHeight;
    }

    // æ¸¬è©¦å‡½æ•¸
    function testExtractFromLabel() {
      const output = document.getElementById('extractOutput');
      const label = document.getElementById('labelInput').value;

      console.log(`æ¸¬è©¦å¾æ¨™ç±¤æå–: "${label}"`);

      const treeLoader = new LazyTreeLoader('.tree-container');
      const result = treeLoader.extractCodeRangeFromLabel(label);

      if (result && result.start && result.end) {
        output.innerHTML = `
          <div class="output-success">âœ… æˆåŠŸå¾æ¨™ç±¤æå–ï¼</div>
          <div class="output-info">
            èµ·å§‹ä»£ç¢¼: ${result.start}<br>
            çµæŸä»£ç¢¼: ${result.end}
          </div>
        `;
      } else {
        output.innerHTML = `
          <div class="output-warning">âš ï¸ æ¨™ç±¤ä¸­æœªæ‰¾åˆ°ä»£ç¢¼ç¯„åœ</div>
          <div class="output-info">çµæœ: ${JSON.stringify(result)}</div>
        `;
      }
    }

    function testExtractFromContent() {
      const output = document.getElementById('extractOutput');
      const content = document.getElementById('contentInput').value;

      console.log(`æ¸¬è©¦å¾å…§å®¹æå–: "${content}"`);

      const treeLoader = new LazyTreeLoader('.tree-container');
      const result = treeLoader.extractCodeRangeFromLabel(content);

      if (result && result.start && result.end) {
        output.innerHTML = `
          <div class="output-success">âœ… æˆåŠŸå¾å…§å®¹æå–ï¼</div>
          <div class="output-info">
            èµ·å§‹ä»£ç¢¼: ${result.start}<br>
            çµæŸä»£ç¢¼: ${result.end}
          </div>
        `;
      } else {
        output.innerHTML = `
          <div class="output-error">âŒ å…§å®¹ä¸­æœªæ‰¾åˆ°ä»£ç¢¼ç¯„åœ</div>
          <div class="output-info">çµæœ: ${JSON.stringify(result)}</div>
        `;
      }
    }

    function testFilterByCodeRange() {
      const output = document.getElementById('filterOutput');
      const startCode = document.getElementById('startCodeInput').value;
      const endCode = document.getElementById('endCodeInput').value;

      console.log(`æ¸¬è©¦ç¯©é¸ç¯„åœ: ${startCode}-${endCode}`);

      if (!window.csvTableRenderer) {
        output.innerHTML = `<div class="output-error">âŒ csvTableRenderer æœªåˆå§‹åŒ–ï¼</div>`;
        return;
      }

      if (!window.csvTableRenderer.csvData || window.csvTableRenderer.csvData.length === 0) {
        output.innerHTML = `
          <div class="output-error">âŒ CSV æ•¸æ“šæœªåŠ è¼‰</div>
          <div class="output-info">csvData é•·åº¦: ${window.csvTableRenderer.csvData?.length || 0}</div>
        `;
        return;
      }

      // æ‰‹å‹•æ¸¬è©¦ç¯©é¸é‚è¼¯
      const startNum = parseInt(startCode);
      const endNum = parseInt(endCode);
      const filtered = window.csvTableRenderer.csvData.filter(item => {
        const itemCode = parseInt(item.code || 0);
        return itemCode >= startNum && itemCode <= endNum;
      });

      output.innerHTML = `
        <div class="output-info">
          CSV ç¸½è¨˜éŒ„æ•¸: ${window.csvTableRenderer.csvData.length}<br>
          ç¯©é¸ç¯„åœ: ${startCode}-${endCode}<br>
          <strong class="output-success">ç¯©é¸çµæœ: ${filtered.length} ç­†è¨˜éŒ„</strong>
        </div>
        <div style="margin-top: 10px;">
          <strong>æ¨£æœ¬è¨˜éŒ„ï¼š</strong><br>
          ${filtered.slice(0, 5).map(item => `${item.code} - ${item.name}`).join('<br>')}
          ${filtered.length > 5 ? `<br>... é‚„æœ‰ ${filtered.length - 5} ç­†` : ''}
        </div>
      `;

      // èª¿ç”¨å¯¦éš›çš„ç¯©é¸æ–¹æ³•
      console.log(`èª¿ç”¨ filterByCodeRange('${startCode}', '${endCode}')`);
      window.csvTableRenderer.filterByCodeRange(startCode, endCode);
    }

    function checkSystemStatus() {
      const output = document.getElementById('statusOutput');
      let html = '';

      // æª¢æŸ¥ csvTableRenderer
      const rendererOk = !!window.csvTableRenderer;
      html += `<div class="status-badge ${rendererOk ? 'status-ok' : 'status-error'}">
        ${rendererOk ? 'âœ…' : 'âŒ'} csvTableRenderer: ${rendererOk ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}
      </div>`;

      // æª¢æŸ¥ CSV æ•¸æ“š
      const csvDataOk = window.csvTableRenderer?.csvData?.length > 0;
      const csvDataCount = window.csvTableRenderer?.csvData?.length || 0;
      html += `<div class="status-badge ${csvDataOk ? 'status-ok' : 'status-error'}">
        ${csvDataOk ? 'âœ…' : 'âŒ'} CSV æ•¸æ“š: ${csvDataCount} ç­†
      </div>`;

      // æª¢æŸ¥ä»£ç¢¼ 48001-48035
      if (csvDataOk) {
        const codesInRange = window.csvTableRenderer.csvData.filter(item => {
          const code = parseInt(item.code || 0);
          return code >= 48001 && code <= 48035;
        });
        const rangeOk = codesInRange.length > 0;
        html += `<div class="status-badge ${rangeOk ? 'status-ok' : 'status-warning'}">
          ${rangeOk ? 'âœ…' : 'âš ï¸'} ä»£ç¢¼ 48001-48035: ${codesInRange.length} ç­†
        </div>`;
      }

      // æª¢æŸ¥æ¨¹å½¢åŠ è¼‰å™¨
      const treeLoaderOk = window.LazyTreeLoader !== undefined;
      html += `<div class="status-badge ${treeLoaderOk ? 'status-ok' : 'status-error'}">
        ${treeLoaderOk ? 'âœ…' : 'âŒ'} LazyTreeLoader: ${treeLoaderOk ? 'å·²åŠ è¼‰' : 'æœªåŠ è¼‰'}
      </div>`;

      // æª¢æŸ¥è¡¨æ ¼å®¹å™¨
      const tablePanel = document.querySelector('.csv-panel');
      const tablePanelOk = !!tablePanel;
      html += `<div class="status-badge ${tablePanelOk ? 'status-ok' : 'status-error'}">
        ${tablePanelOk ? 'âœ…' : 'âŒ'} è¡¨æ ¼é¢æ¿: ${tablePanelOk ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}
      </div>`;

      output.innerHTML = html;
      console.log('ç³»çµ±ç‹€æ…‹æª¢æŸ¥å®Œæˆ');
    }

    function resetDebugConsole() {
      debugLogs.length = 0;
      document.getElementById('consoleOutput').innerHTML = '<div class="output-info">æ—¥èªŒå·²æ¸…ç©º</div>';
    }

    // åˆå§‹åŒ–
    console.log('è¨ºæ–·å·¥å…·å·²åŠ è¼‰ï¼Œè«‹åŸ·è¡Œæ¸¬è©¦...');
    checkSystemStatus();
  </script>
</body>
</html>
