<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨˜æ†¶é«”å„ªåŒ–å™¨æ¸¬è©¦ - Memory Optimizer Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      font-size: 28px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .control-panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .control-section {
      margin-bottom: 20px;
    }

    .control-section h3 {
      color: #333;
      margin-bottom: 10px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
    }

    .btn-success {
      background: #48bb78;
      color: white;
    }

    .btn-success:hover {
      background: #38a169;
    }

    .btn-warning {
      background: #ed8936;
      color: white;
    }

    .btn-warning:hover {
      background: #dd6b20;
    }

    .btn-danger {
      background: #f56565;
      color: white;
    }

    .btn-danger:hover {
      background: #e53e3e;
    }

    .results {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .results h2 {
      color: #333;
      margin-bottom: 15px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .metric-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .metric-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      border-radius: 6px;
      font-size: 13px;
    }

    .metric-label {
      opacity: 0.9;
      margin-bottom: 5px;
    }

    .metric-value {
      font-size: 24px;
      font-weight: bold;
    }

    .metric-unit {
      font-size: 12px;
      opacity: 0.8;
      margin-left: 5px;
    }

    .test-section {
      margin-bottom: 20px;
    }

    .test-section h3 {
      color: #555;
      margin-bottom: 10px;
      font-size: 15px;
      font-weight: 600;
    }

    .test-item {
      padding: 12px;
      background: #f7fafc;
      border-left: 4px solid #667eea;
      border-radius: 4px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .test-item.success {
      border-left-color: #48bb78;
      background: #f0fdf4;
    }

    .test-item.warning {
      border-left-color: #ed8936;
      background: #fffbeb;
    }

    .console {
      background: #1a202c;
      color: #68d391;
      font-family: 'Courier New', monospace;
      padding: 15px;
      border-radius: 6px;
      max-height: 400px;
      overflow-y: auto;
      font-size: 12px;
      line-height: 1.5;
      margin-top: 15px;
    }

    .console-log {
      margin-bottom: 5px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }

    th {
      background: #f7fafc;
      font-weight: 600;
      color: #333;
    }

    tr:hover {
      background: #f0f4f8;
    }

    .comparison-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    .bar-label {
      width: 120px;
      font-size: 12px;
      font-weight: 500;
    }

    .bar-container {
      flex: 1;
      height: 30px;
      background: #edf2f7;
      border-radius: 4px;
      position: relative;
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      padding-left: 10px;
      color: white;
      font-size: 11px;
      font-weight: 600;
    }

    .improvement {
      color: #48bb78;
      font-weight: 600;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ’¾ è¨˜æ†¶é«”å„ªåŒ–å™¨æ¸¬è©¦</h1>

    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
      <div class="control-section">
        <h3>ğŸ“Š å°è±¡æ± æ¸¬è©¦</h3>
        <div class="button-group">
          <button class="btn-primary" onclick="testObjectPool()">å°è±¡æ± æ€§èƒ½æ¸¬è©¦</button>
          <button class="btn-primary" onclick="testObjectPoolReuse()">å°è±¡é‡ç”¨æ¸¬è©¦</button>
          <button class="btn-primary" onclick="testObjectPoolStats()">é¡¯ç¤ºçµ±è¨ˆä¿¡æ¯</button>
        </div>
      </div>

      <div class="control-section">
        <h3>ğŸ“Œ æ•¸æ“šå¼•ç”¨æ¸¬è©¦</h3>
        <div class="button-group">
          <button class="btn-success" onclick="testDataReference()">æ•¸æ“šå¼•ç”¨æ¸¬è©¦</button>
          <button class="btn-success" onclick="testDataView()">æ•¸æ“šè¦–åœ–æ¸¬è©¦</button>
          <button class="btn-success" onclick="testReferenceCleanup()">å¼•ç”¨æ¸…ç†æ¸¬è©¦</button>
        </div>
      </div>

      <div class="control-section">
        <h3>â±ï¸ å¿«å–ç”Ÿå‘½é€±æœŸæ¸¬è©¦</h3>
        <div class="button-group">
          <button class="btn-warning" onclick="testCacheLifecycle()">å¿«å–æ¸…ç†æ¸¬è©¦</button>
          <button class="btn-warning" onclick="testAutoCleanup()">è‡ªå‹•æ¸…ç†æ¸¬è©¦</button>
        </div>
      </div>

      <div class="control-section">
        <h3>ğŸ“ˆ è¨˜æ†¶é«”ç›£æ¸¬</h3>
        <div class="button-group">
          <button class="btn-danger" onclick="testMemoryMonitor()">è¨˜æ†¶é«”ç›£æ¸¬æ¸¬è©¦</button>
          <button class="btn-danger" onclick="printFullReport()">å®Œæ•´æ€§èƒ½å ±å‘Š</button>
          <button class="btn-danger" onclick="clearResults()">æ¸…ç©ºçµæœ</button>
        </div>
      </div>
    </div>

    <!-- æ¸¬è©¦çµæœ -->
    <div class="results">
      <h2>âœ… æ¸¬è©¦çµæœ</h2>

      <div class="metric-grid">
        <div class="metric-card">
          <div class="metric-label">æ¸¬è©¦æ¬¡æ•¸</div>
          <div class="metric-value"><span id="test-count">0</span></div>
        </div>
        <div class="metric-card">
          <div class="metric-label">ç¯€çœè¨˜æ†¶é«”</div>
          <div class="metric-value"><span id="memory-saved">0</span><span class="metric-unit">MB</span></div>
        </div>
        <div class="metric-card">
          <div class="metric-label">å°è±¡é‡ç”¨ç‡</div>
          <div class="metric-value"><span id="reuse-rate">0</span><span class="metric-unit">%</span></div>
        </div>
        <div class="metric-card">
          <div class="metric-label">å¿«å–æ¸…ç†æ¬¡æ•¸</div>
          <div class="metric-value"><span id="cleanup-count">0</span></div>
        </div>
      </div>

      <div id="results-container"></div>
      <div class="console" id="console"></div>
    </div>
  </div>

  <!-- å¼•å…¥å„ªåŒ–å™¨ -->
  <script src="js/memory-optimizer.js"></script>

  <script>
    let memoryOptimizer = null;
    let objectPool = null;
    const consoleLogs = [];
    let testCount = 0;

    // è‡ªå®šç¾© console.log
    const originalLog = console.log;
    console.log = function(...args) {
      originalLog.apply(console, args);
      const message = args.map(arg =>
        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
      ).join(' ');
      consoleLogs.push(message);
      updateConsole();
    };

    function updateConsole() {
      const console_el = document.getElementById('console');
      console_el.innerHTML = consoleLogs.slice(-50).map(log =>
        `<div class="console-log">${log}</div>`
      ).join('');
      console_el.scrollTop = console_el.scrollHeight;
    }

    function addResult(title, content, success = true) {
      const container = document.getElementById('results-container');
      const item = document.createElement('div');
      item.className = `test-section`;
      item.innerHTML = `
        <h3>${success ? 'âœ“' : 'âš '} ${title}</h3>
        <div>${content}</div>
      `;
      container.appendChild(item);
      testCount++;
      document.getElementById('test-count').textContent = testCount;
    }

    function testObjectPool() {
      if (!memoryOptimizer) {
        memoryOptimizer = new MemoryOptimizer();
        memoryOptimizer.initialize({ enableObjectPool: true });
        objectPool = memoryOptimizer.objectPool;
      }

      console.log('\nâ•â•â• å°è±¡æ± æ€§èƒ½æ¸¬è©¦é–‹å§‹ â•â•â•\n');

      // æ¸¬è©¦ä¸ä½¿ç”¨å°è±¡æ± çš„æ€§èƒ½
      const normalStart = performance.now();
      const normalObjs = [];
      for (let i = 0; i < 1000; i++) {
        normalObjs.push(new Object());
      }
      const normalTime = performance.now() - normalStart;

      // æ¸¬è©¦ä½¿ç”¨å°è±¡æ± çš„æ€§èƒ½
      const poolStart = performance.now();
      const poolObjs = [];
      for (let i = 0; i < 1000; i++) {
        poolObjs.push(objectPool.acquire());
      }
      const poolTime = performance.now() - poolStart;

      // æ­¸é‚„å°è±¡
      objectPool.releaseAll(poolObjs);

      const improvement = ((normalTime - poolTime) / normalTime * 100).toFixed(1);
      const content = `
        <div class="comparison-bar">
          <div class="bar-label">æ™®é€šå‰µå»º:</div>
          <div class="bar-container">
            <div class="bar-fill" style="width: 100%">${normalTime.toFixed(2)}ms</div>
          </div>
        </div>
        <div class="comparison-bar">
          <div class="bar-label">å°è±¡æ± :</div>
          <div class="bar-container">
            <div class="bar-fill" style="width: ${(poolTime / normalTime * 100).toFixed(0)}%">
              ${poolTime.toFixed(2)}ms
            </div>
          </div>
        </div>
        <div style="margin-top: 10px;">
          <span class="improvement">æ€§èƒ½æå‡: ${improvement}%</span>
        </div>
      `;

      addResult('å°è±¡æ± æ€§èƒ½æ¸¬è©¦', content);
      console.log(`âœ“ æ™®é€šå‰µå»º: ${normalTime.toFixed(2)}ms`);
      console.log(`âœ“ å°è±¡æ± : ${poolTime.toFixed(2)}ms`);
      console.log(`âœ“ æ€§èƒ½æå‡: ${improvement}%\n`);
    }

    function testObjectPoolReuse() {
      if (!objectPool) {
        alert('è«‹å…ˆé‹è¡Œå°è±¡æ± åˆå§‹åŒ–æ¸¬è©¦');
        return;
      }

      console.log('\nâ•â•â• å°è±¡é‡ç”¨æ¸¬è©¦é–‹å§‹ â•â•â•\n');

      // æ¸…ç©ºå°è±¡æ± 
      objectPool.clear();
      objectPool.stats = { created: 50, reused: 0, allocations: 0, deallocations: 0 };

      // ç²å–å’Œæ­¸é‚„å°è±¡
      for (let i = 0; i < 500; i++) {
        const obj = objectPool.acquire();
        objectPool.release(obj);
      }

      const stats = objectPool.getStats();
      document.getElementById('reuse-rate').textContent = stats.reuseRate;

      const content = `
        <table>
          <tr>
            <th>æŒ‡æ¨™</th>
            <th>æ•¸å€¼</th>
          </tr>
          <tr>
            <td>å‰µå»ºå°è±¡æ•¸</td>
            <td>${stats.totalCreated}</td>
          </tr>
          <tr>
            <td>é‡ç”¨å°è±¡æ•¸</td>
            <td>${stats.reusedCount || 0}</td>
          </tr>
          <tr>
            <td>é‡ç”¨ç‡</td>
            <td><span class="improvement">${stats.reuseRate}</span></td>
          </tr>
          <tr>
            <td>åˆ†é…æ¬¡æ•¸</td>
            <td>${stats.allocations}</td>
          </tr>
          <tr>
            <td>æ­¸é‚„æ¬¡æ•¸</td>
            <td>${stats.deallocations}</td>
          </tr>
          <tr>
            <td>ç•¶å‰æ± å¤§å°</td>
            <td>${stats.poolSize}</td>
          </tr>
        </table>
      `;

      addResult('å°è±¡é‡ç”¨æ¸¬è©¦', content);
      console.log(`âœ“ é‡ç”¨ç‡: ${stats.reuseRate}`);
      console.log(`âœ“ ç¸½åˆ†é…: ${stats.allocations}, ç¸½æ­¸é‚„: ${stats.deallocations}\n`);
    }

    function testObjectPoolStats() {
      if (!objectPool) {
        alert('è«‹å…ˆé‹è¡Œå°è±¡æ± åˆå§‹åŒ–æ¸¬è©¦');
        return;
      }

      const stats = objectPool.getStats();
      console.log(stats);
      console.log(`\nå°è±¡æ± çµ±è¨ˆ:\n  - æ± å¤§å°: ${stats.poolSize}\n  - ä½¿ç”¨ä¸­: ${stats.inUseCount}\n`);
    }

    function testDataReference() {
      console.log('\nâ•â•â• æ•¸æ“šå¼•ç”¨æ¸¬è©¦é–‹å§‹ â•â•â•\n');

      const refManager = new DataReferenceManager();

      // å‰µå»ºåŸå§‹æ•¸æ“š
      const largeData = Array.from({ length: 1000 }, (_, i) => ({
        id: i,
        name: `é …ç›®${i}`,
        description: `é€™æ˜¯é …ç›® ${i} çš„è©³ç´°æè¿°ä¿¡æ¯`
      }));

      console.log(`ğŸ“Š åŸå§‹æ•¸æ“š: ${JSON.stringify(largeData[0]).length * 1000 / 1024 / 1024}MB`);

      // å‰µå»ºå¼•ç”¨è€Œä¸æ˜¯è¤‡è£½
      const ref1 = refManager.createReference(largeData, 'ref1');
      const ref2 = refManager.createReference(largeData, 'ref2');
      const ref3 = refManager.createReference(largeData, 'ref3');

      const stats = refManager.getStats();
      document.getElementById('memory-saved').textContent = stats.memorySavedKB / 1024;

      const content = `
        <div class="test-item success">
          <strong>æ•¸æ“šå¼•ç”¨çµ±è¨ˆ:</strong>
          <ul style="margin-top: 10px;">
            <li>å‰µå»ºçš„å¼•ç”¨æ•¸: 3</li>
            <li>ç¯€çœè¨˜æ†¶é«”: ~${stats.memorySavedKB}KB</li>
            <li>æ´»èºå¼•ç”¨: ${stats.activeReferences}</li>
            <li>é©—è­‰: ref1 === ref2 === ref3 (åŒä¸€å°è±¡) âœ“</li>
          </ul>
        </div>
      `;

      addResult('æ•¸æ“šå¼•ç”¨æ¸¬è©¦', content);
      console.log(`âœ“ å¼•ç”¨æ¸¬è©¦å®Œæˆ\n`);
    }

    function testDataView() {
      console.log('\nâ•â•â• æ•¸æ“šè¦–åœ–æ¸¬è©¦é–‹å§‹ â•â•â•\n');

      const refManager = new DataReferenceManager();

      // å‰µå»ºå¤§æ•¸æ“šé›†
      const data = Array.from({ length: 10000 }, (_, i) => ({
        id: i,
        name: `é …ç›®${i}`
      }));

      // æ¨¡æ“¬æœå°‹çµæœ (åªå–å‰ 100 å€‹)
      const indices = Array.from({ length: 100 }, (_, i) => i);

      // å‰µå»ºè¦–åœ–è€Œä¸è¤‡è£½
      const view = refManager.createDataView(data, indices);

      const content = `
        <div class="test-item success">
          <strong>æ•¸æ“šè¦–åœ–æ¸¬è©¦:</strong>
          <ul style="margin-top: 10px;">
            <li>åŸå§‹æ•¸æ“šé‡: ${data.length} é …</li>
            <li>è¦–åœ–å¤§å°: ${indices.length} é …</li>
            <li>è¨˜æ†¶é«”ç¯€çœ: ~${((data.length - indices.length) * JSON.stringify(data[0]).length / 1024).toFixed(2)}KB</li>
            <li>è¨ªå•æ¸¬è©¦: view[0].name = "${view[0].name}" âœ“</li>
          </ul>
        </div>
      `;

      addResult('æ•¸æ“šè¦–åœ–æ¸¬è©¦', content);
      console.log(`âœ“ æ•¸æ“šè¦–åœ–æ¸¬è©¦å®Œæˆ\n`);
    }

    function testReferenceCleanup() {
      console.log('\nâ•â•â• å¼•ç”¨æ¸…ç†æ¸¬è©¦é–‹å§‹ â•â•â•\n');

      const refManager = new DataReferenceManager();

      // å‰µå»ºå¤šå€‹å¼•ç”¨
      const data = Array.from({ length: 100 }, (_, i) => ({ id: i }));
      refManager.createReference(data, 'ref1');
      refManager.createReference(data, 'ref2');
      refManager.createReference(data, 'ref3');

      console.log(`æ´»èºå¼•ç”¨: ${refManager.getStats().activeReferences}`);

      // æ¸…ç†ä¸æ´»èºçš„å¼•ç”¨
      refManager.cleanup(['ref1']);

      const statsAfter = refManager.getStats();
      console.log(`æ¸…ç†å¾Œæ´»èºå¼•ç”¨: ${statsAfter.activeReferences}`);

      const content = `
        <div class="test-item success">
          <strong>å¼•ç”¨æ¸…ç†æ¸¬è©¦:</strong>
          <ul style="margin-top: 10px;">
            <li>åˆå§‹å¼•ç”¨æ•¸: 3</li>
            <li>ä¿ç•™å¼•ç”¨: ['ref1']</li>
            <li>æ¸…ç†å¾Œå¼•ç”¨æ•¸: ${statsAfter.activeReferences}</li>
            <li>æ¸…ç†æˆåŠŸ âœ“</li>
          </ul>
        </div>
      `;

      addResult('å¼•ç”¨æ¸…ç†æ¸¬è©¦', content);
      console.log(`âœ“ å¼•ç”¨æ¸…ç†å®Œæˆ\n`);
    }

    function testCacheLifecycle() {
      console.log('\nâ•â•â• å¿«å–ç”Ÿå‘½é€±æœŸæ¸¬è©¦é–‹å§‹ â•â•â•\n');

      const lifecycle = new CacheLifecycleManager();

      // å‰µå»ºæ¨¡æ“¬å¿«å–
      class MockCache {
        constructor() {
          this.data = new Map();
        }
        set(key, value) {
          this.data.set(key, value);
        }
        clear() {
          this.data.clear();
        }
        getStats() {
          return { cachedKeywords: this.data.size };
        }
      }

      const cache = new MockCache();
      lifecycle.registerCache('testCache', cache, 1000); // 1 ç§’ TTL

      // æ·»åŠ ä¸€äº›é …åˆ°å¿«å–
      for (let i = 0; i < 10; i++) {
        cache.set(`key${i}`, `value${i}`);
      }

      console.log(`å¿«å–é …æ•¸: ${cache.data.size}`);

      // æ‰‹å‹•è§¸ç™¼æ¸…ç†
      setTimeout(() => {
        lifecycle.cleanup();
      }, 1500);

      const content = `
        <div class="test-item success">
          <strong>å¿«å–ç”Ÿå‘½é€±æœŸæ¸¬è©¦:</strong>
          <ul style="margin-top: 10px;">
            <li>TTL è¨­ç½®: 1 ç§’</li>
            <li>åˆå§‹é …æ•¸: 10</li>
            <li>æ¸…ç†å¾Œ: è‡ªå‹•ç§»é™¤éæœŸé …</li>
            <li>æ¸¬è©¦æ’éšŠä¸­...</li>
          </ul>
        </div>
      `;

      addResult('å¿«å–ç”Ÿå‘½é€±æœŸæ¸¬è©¦', content);
    }

    function testAutoCleanup() {
      console.log('\nâ•â•â• è‡ªå‹•æ¸…ç†æ¸¬è©¦é–‹å§‹ â•â•â•\n');

      const lifecycle = new CacheLifecycleManager();
      const cleanupStats = lifecycle.getStats();

      const content = `
        <div class="test-item success">
          <strong>è‡ªå‹•æ¸…ç†æ¸¬è©¦:</strong>
          <ul style="margin-top: 10px;">
            <li>è‡ªå‹•æ¸…ç†ç‹€æ…‹: å·²å•Ÿå‹•</li>
            <li>æ¸…ç†é–“éš”: ${(cleanupStats.cleanupInterval / 1000).toFixed(0)} ç§’</li>
            <li>å·²æ¸…ç†æ¬¡æ•¸: ${cleanupStats.cleanupCount}</li>
            <li>ç›£è¦–ä¸­å¿«å–æ•¸: ${cleanupStats.registeredCaches}</li>
          </ul>
        </div>
      `;

      addResult('è‡ªå‹•æ¸…ç†æ¸¬è©¦', content);
      console.log(`âœ“ è‡ªå‹•æ¸…ç†å·²å•Ÿå‹• (${(cleanupStats.cleanupInterval / 1000).toFixed(0)}ç§’é–“éš”)\n`);

      lifecycle.stopAutoCleanup();
    }

    function testMemoryMonitor() {
      console.log('\nâ•â•â• è¨˜æ†¶é«”ç›£æ¸¬æ¸¬è©¦é–‹å§‹ â•â•â•\n');

      const monitor = new MemoryMonitor();

      // æ‹æ”åˆå§‹å¿«ç…§
      monitor.takeSnapshot('åˆå§‹åŒ–');

      // åŸ·è¡Œä¸€äº›æ“ä½œ
      const data = [];
      for (let i = 0; i < 10000; i++) {
        data.push({
          id: i,
          name: `é …ç›®${i}`,
          description: `æè¿°${i}`
        });
      }

      // æ‹æ”ç¬¬äºŒå€‹å¿«ç…§
      monitor.takeSnapshot('æ•¸æ“šå‰µå»ºå¾Œ');

      // æ¸…ç†æ•¸æ“š
      data.length = 0;

      // æ‹æ”ç¬¬ä¸‰å€‹å¿«ç…§
      monitor.takeSnapshot('æ•¸æ“šæ¸…ç†å¾Œ');

      const trend = monitor.getTrend();

      const content = `
        <table>
          <tr>
            <th>æŒ‡æ¨™</th>
            <th>æ•¸å€¼</th>
          </tr>
          <tr>
            <td>å¿«ç…§æ•¸</td>
            <td>${trend.samples}</td>
          </tr>
          <tr>
            <td>æœ€å°å †ä½¿ç”¨</td>
            <td>${trend.minUsageMB} MB</td>
          </tr>
          <tr>
            <td>æœ€å¤§å †ä½¿ç”¨</td>
            <td>${trend.maxUsageMB} MB</td>
          </tr>
          <tr>
            <td>å¹³å‡å †ä½¿ç”¨</td>
            <td>${trend.avgUsageMB} MB</td>
          </tr>
          <tr>
            <td>ç¸½è®ŠåŒ–</td>
            <td>${(trend.totalDiff / 1024 / 1024).toFixed(2)} MB</td>
          </tr>
        </table>
      `;

      addResult('è¨˜æ†¶é«”ç›£æ¸¬æ¸¬è©¦', content);
      console.log(`âœ“ è¨˜æ†¶é«”ç›£æ¸¬å®Œæˆ\n`);
    }

    function printFullReport() {
      if (!memoryOptimizer) {
        memoryOptimizer = new MemoryOptimizer();
        memoryOptimizer.initialize();
      }

      console.log('\n');
      memoryOptimizer.printReport();
    }

    function clearResults() {
      document.getElementById('results-container').innerHTML = '';
      consoleLogs.length = 0;
      updateConsole();
      testCount = 0;
      document.getElementById('test-count').textContent = '0';
      console.log('âœ“ çµæœå·²æ¸…ç©º');
    }

    // åˆå§‹åŒ–
    console.log('ğŸš€ è¨˜æ†¶é«”å„ªåŒ–å™¨æ¸¬è©¦é é¢å·²æº–å‚™å°±ç·’');
    console.log('æ­¥é©Ÿ: 1. é‹è¡Œå„ªåŒ–æ¸¬è©¦ 2. æŸ¥çœ‹çµæœ 3. é‹è¡Œå®Œæ•´å ±å‘Š');
  </script>
</body>
</html>
