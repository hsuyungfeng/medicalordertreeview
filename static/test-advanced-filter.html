<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é«˜ç´šç¯©é¸åŠŸèƒ½æ¸¬è©¦ - Advanced Filter Test</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      font-size: 28px;
    }
    .control-panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .control-section {
      margin-bottom: 20px;
    }
    .control-section h3 {
      color: #333;
      margin-bottom: 10px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .btn-primary { background: #667eea; color: white; }
    .btn-primary:hover { background: #5568d3; }
    .btn-success { background: #48bb78; color: white; }
    .btn-success:hover { background: #38a169; }
    .btn-danger { background: #f56565; color: white; }
    .btn-danger:hover { background: #e53e3e; }
    .results {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .results h2 {
      color: #333;
      margin-bottom: 15px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }
    .test-item {
      padding: 12px;
      background: #f7fafc;
      border-left: 4px solid #667eea;
      border-radius: 4px;
      margin-bottom: 8px;
      font-size: 13px;
    }
    .test-item.passed { border-left-color: #48bb78; background: #f0fdf4; }
    .console {
      background: #1a202c;
      color: #68d391;
      font-family: 'Courier New', monospace;
      padding: 15px;
      border-radius: 6px;
      max-height: 300px;
      overflow-y: auto;
      font-size: 12px;
      margin-top: 15px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }
    th { background: #f7fafc; font-weight: 600; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” é«˜ç´šç¯©é¸åŠŸèƒ½æ¸¬è©¦</h1>

    <div class="control-panel">
      <div class="control-section">
        <h3>ğŸ“Š ç”Ÿæˆæ¸¬è©¦æ•¸æ“š</h3>
        <div class="button-group">
          <button class="btn-primary" onclick="generateData(100)">100 ç­†</button>
          <button class="btn-primary" onclick="generateData(500)">500 ç­†</button>
          <button class="btn-primary" onclick="generateData(1000)">1000 ç­†</button>
        </div>
      </div>

      <div class="control-section">
        <h3>ğŸ§ª é‹è¡Œæ¸¬è©¦</h3>
        <div class="button-group">
          <button class="btn-success" onclick="testColumnFilter()">åˆ—ç¯©é¸æ¸¬è©¦</button>
          <button class="btn-success" onclick="testDateRange()">æ—¥æœŸç¯„åœæ¸¬è©¦</button>
          <button class="btn-success" onclick="testNumericRange()">æ•¸å€¼ç¯„åœæ¸¬è©¦</button>
          <button class="btn-success" onclick="testCompositeFilter()">è¤‡åˆç¯©é¸æ¸¬è©¦</button>
          <button class="btn-danger" onclick="clearResults()">æ¸…ç©ºçµæœ</button>
        </div>
      </div>
    </div>

    <div class="results">
      <h2>âœ… æ¸¬è©¦çµæœ</h2>
      <div id="test-results"></div>
      <div class="console" id="console"></div>
    </div>
  </div>

  <script src="js/advanced-filter.js"></script>
  <script>
    let advancedFilter = null;
    let testData = [];
    const consoleLogs = [];

    const originalLog = console.log;
    console.log = function(...args) {
      originalLog.apply(console, args);
      const message = args.join(' ');
      consoleLogs.push(message);
      updateConsole();
    };

    function updateConsole() {
      const el = document.getElementById('console');
      el.innerHTML = consoleLogs.slice(-30).map(log =>
        `<div>${log}</div>`
      ).join('');
      el.scrollTop = el.scrollHeight;
    }

    function generateData(count) {
      console.log(`\nğŸ“ æ­£åœ¨ç”Ÿæˆ ${count} ç­†æ¸¬è©¦æ•¸æ“š...`);
      
      const categories = ['æª¢æŸ¥', 'æ²»ç™‚', 'è—¥ç‰©'];
      testData = [];
      const today = new Date();

      for (let i = 0; i < count; i++) {
        const date = new Date(today);
        date.setDate(date.getDate() - Math.floor(Math.random() * 365));

        testData.push({
          id: String(i).padStart(6, '0'),
          category: categories[i % categories.length],
          name: `é …ç›®${i}`,
          points: Math.floor(Math.random() * 1000) + 100,
          effectiveDate: date.toISOString().split('T')[0],
          status: Math.random() > 0.5 ? 'æœ‰æ•ˆ' : 'ç„¡æ•ˆ'
        });
      }

      advancedFilter = new AdvancedFilter();
      console.log(`âœ“ ç”Ÿæˆå®Œæˆ - ${count} ç­†æ•¸æ“š`);
    }

    function testColumnFilter() {
      if (!advancedFilter) {
        alert('è«‹å…ˆç”Ÿæˆæ¸¬è©¦æ•¸æ“š');
        return;
      }

      console.log('\nâ•â•â• åˆ—ç¯©é¸æ¸¬è©¦é–‹å§‹ â•â•â•\n');

      advancedFilter.clear();
      advancedFilter.addColumnFilter('category', ['æª¢æŸ¥', 'æ²»ç™‚']);

      const result = advancedFilter.filter(testData);
      addTestResult(`åˆ—ç¯©é¸ (category=['æª¢æŸ¥','æ²»ç™‚'])`, 
        `æ‰¾åˆ° ${result.count} ç­†çµæœ (${result.time}ms)`, true);

      console.log(`âœ“ çµæœ: ${result.count} ç­†\n`);
    }

    function testDateRange() {
      if (!advancedFilter) {
        alert('è«‹å…ˆç”Ÿæˆæ¸¬è©¦æ•¸æ“š');
        return;
      }

      console.log('\nâ•â•â• æ—¥æœŸç¯„åœæ¸¬è©¦é–‹å§‹ â•â•â•\n');

      advancedFilter.clear();
      const startDate = new Date();
      startDate.setDate(startDate.getDate() - 180);
      const endDate = new Date();

      advancedFilter.addDateRange('effectiveDate', startDate, endDate);

      const result = advancedFilter.filter(testData);
      addTestResult(`æ—¥æœŸç¯„åœç¯©é¸ (æœ€è¿‘180å¤©)`, 
        `æ‰¾åˆ° ${result.count} ç­†çµæœ (${result.time}ms)`, true);

      console.log(`âœ“ çµæœ: ${result.count} ç­†\n`);
    }

    function testNumericRange() {
      if (!advancedFilter) {
        alert('è«‹å…ˆç”Ÿæˆæ¸¬è©¦æ•¸æ“š');
        return;
      }

      console.log('\nâ•â•â• æ•¸å€¼ç¯„åœæ¸¬è©¦é–‹å§‹ â•â•â•\n');

      advancedFilter.clear();
      advancedFilter.addNumericRange('points', 200, 800);

      const result = advancedFilter.filter(testData);
      addTestResult(`æ•¸å€¼ç¯„åœç¯©é¸ (points 200-800)`, 
        `æ‰¾åˆ° ${result.count} ç­†çµæœ (${result.time}ms)`, true);

      console.log(`âœ“ çµæœ: ${result.count} ç­†\n`);
    }

    function testCompositeFilter() {
      if (!advancedFilter) {
        alert('è«‹å…ˆç”Ÿæˆæ¸¬è©¦æ•¸æ“š');
        return;
      }

      console.log('\nâ•â•â• è¤‡åˆç¯©é¸æ¸¬è©¦é–‹å§‹ â•â•â•\n');

      advancedFilter.clear();
      advancedFilter.addColumnFilter('category', ['æª¢æŸ¥']);
      advancedFilter.addNumericRange('points', 200, 500);

      const startDate = new Date();
      startDate.setDate(startDate.getDate() - 180);
      advancedFilter.addDateRange('effectiveDate', startDate, new Date());

      const result = advancedFilter.filter(testData);
      addTestResult(`è¤‡åˆç¯©é¸ (category + points + date)`, 
        `æ‰¾åˆ° ${result.count} ç­†çµæœ (${result.time}ms)`, true);

      advancedFilter.printReport();
      console.log(`\nâœ“ è¤‡åˆç¯©é¸å®Œæˆ\n`);
    }

    function addTestResult(name, result, passed) {
      const container = document.getElementById('test-results');
      const item = document.createElement('div');
      item.className = `test-item ${passed ? 'passed' : 'failed'}`;
      item.innerHTML = `<strong>${passed ? 'âœ“' : 'âœ—'} ${name}</strong><br><small>${result}</small>`;
      container.appendChild(item);
    }

    function clearResults() {
      document.getElementById('test-results').innerHTML = '';
      consoleLogs.length = 0;
      updateConsole();
      console.log('âœ“ çµæœå·²æ¸…ç©º');
    }

    console.log('ğŸš€ é«˜ç´šç¯©é¸æ¸¬è©¦é é¢å·²æº–å‚™å°±ç·’');
  </script>
</body>
</html>
